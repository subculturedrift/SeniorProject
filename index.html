<!DOCTYPE html>
<html>
<head>
	<title>Harmonana: Harmony Analysis</title>
	<link rel="stylesheet" type="text/css" href="harmonana.css">

</head>
<body>

<!--Create a table of options for voice selection-->
	<table>
		<tbody>
			<tr id="SOPRANO">
				<td><label for="soprano">Soprano: </label></td>
				<td><input type="radio" name="voice" id="soprano" checked></td>
			</tr>
			<tr id="ALTO">
				<td><label for="alto">Alto: </label></td>
				<td><input type="radio" name="voice" id="alto"></td>
			</tr>
			<tr id="TENOR">
				<td><label for="tenor">Tenor: </label></td>
				<td><input type="radio" name="voice" id="tenor"></td>
			</tr>
			<tr id="BASS">
				<td><label for="bass">Bass: </label></td>
				<td><input type="radio" name="voice" id="bass"></td>
			</tr>
		</tbody>
	</table>


<!-- container used for VexFlow -->
	<div id="boo"></div>
	

<!--Call the Javascript file-->	
	<script src="releases/vexflow-min.js"></script>
    <script src="node_modules/jquery/dist/jquery.js"></script>


<!--Javascript starts here-->	
	<script type="text/javascript">
		VF = Vex.Flow;

		// Width of each measure
		const WIDTH = 200;

		// Variables for assigning colors to voices
		var S_COLOR = "red";
		var A_COLOR = "blue";
		var T_COLOR = "green";
		var B_COLOR = "orange";

		// Values for analysis and for determining if group should be removed (value != null)
		var s1 = null;
		var s2 = null;
		var s3 = null;
		var s4 = null;

		var a1 = null;
		var a2 = null;
		var a3 = null;
		var a4 = null;

		var t1 = null;
		var t2 = null;
		var t3 = null;
		var t4 = null;

		var b1 = null;
		var b2 = null;
		var b3 = null;
		var b4 = null;

		// Create an SVG renderer and attach it to the DIV element named "boo".
		var div = document.getElementById("boo");
		var renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);

		// Configure the rendering context.
		renderer.resize(820, 300);

		// Drawing context:
		var context = renderer.getContext();
		context.setFont("Arial", 10, "").setBackgroundFillStyle("#eed");

		// Create a stave of width 400 at position 10, 40 on the canvas.
		var treble_stave_1 = new VF.Stave(10, 40, WIDTH);
		var bass_stave_1 = new VF.Stave(10, 100, WIDTH);

		var treble_stave_2 = new VF.Stave(210, 40, WIDTH);
		var bass_stave_2 = new VF.Stave(210, 100, WIDTH);

		var treble_stave_3 = new VF.Stave(410, 40, WIDTH);
		var bass_stave_3 = new VF.Stave(410, 100, WIDTH);

		var treble_stave_4 = new VF.Stave(610, 40, WIDTH);
		var bass_stave_4 = new VF.Stave(610, 100, WIDTH);


		// Add a clef and time signature.
		treble_stave_1.addClef("treble").addTimeSignature("4/4");
		bass_stave_1.addClef("bass").addTimeSignature("4/4");	

		// Connect it to the rendering context.
		treble_stave_1.setContext(context).draw();
		bass_stave_1.setContext(context).draw();

		treble_stave_2.setContext(context).draw();
		bass_stave_2.setContext(context).draw();

		treble_stave_3.setContext(context).draw();
		bass_stave_3.setContext(context).draw();

		treble_stave_4.setContext(context).draw();
		bass_stave_4.setContext(context).draw();
		

var notes = [
        // A quarter C note:
        new VF.StaveNote({clef: "treble", keys: ["c/4"], duration: "w" })
        ];

        // Create a voice in 4/4 and add above notes:
        // Create a contect group so it can be deleted when we want to redraw notes:
        var group = context.openGroup();

        var group_s1 = null;
        var group_s2 = null;
        var group_s3 = null;
        var group_s4 = null;

        var group_a1 = null;
        var group_a2 = null;
        var group_a3 = null;
        var group_a4 = null;

        var group_t1 = null;
        var group_t2 = null;
        var group_t3 = null;
        var group_t4 = null;

        var group_b1 = null;
        var group_b2 = null;
        var group_b3 = null;
        var group_b4 = null;

        // Draw your measure as you normally would:
        var voice = new VF.Voice({num_beats: 4, beat_value: 4});
        voice.addTickables(notes);
        // Format and justify the notes to 400 pixels:
        var formatter = new VF.Formatter().joinVoices([voice]).format([voice], 750);
        // Render voice
        // voice.draw(context, treble_stave_1);
        // Then close the group:
        context.closeGroup();
        // And when you want to delete it, do this:
        // context.svg.removeChild(group);

        // Get key based on Y poisition of user click:
        function getKeyFromScreenY( y ) {
            var key = null;

            // var topLineTopY  = stave.getTopLineTopY();
            if (y < 76) {
                key = "a/5";
            } else if (y >= 76 & y <= 79) {
                key = "g/5";
            } else if (y >= 80 & y <= 83) {
                key = "f/5";
            } else if (y >= 84 & y <= 87) {
                key = "e/5";
            } else if (y >= 88 & y <= 91) {
                key = "d/5";
            } else if (y >= 92 & y <= 95) {
                key = "c/5";
            } else if (y >= 96 & y <= 100) {
                key = "b/4";
            } else if (y >= 101 & y <= 106) {
                key = "a/4";
            } else if (y >= 107 & y <= 111) {
                key = "g/4";
            } else if (y >= 112 & y <= 116) {
                key = "f/4";
            } else if (y >= 117 & y <= 121) {
                key = "e/4";
            } else if (y >= 122 & y <= 126) {
                key = "d/4";
            } else if (y >= 127 & y <= 131) {
                key = "c/4";
            } else if (y >= 132 & y <= 136) {
                key = "b/3";
            } else if (y >= 137 & y <= 141) {
                key = "a/3";
            } else if (y >= 142 & y <= 146) {
                key = "g/3";
            } else if (y >= 147 & y <= 151) {
                key = "f/3";
            } else if (y >= 152 & y <= 156) {
                key = "e/3";
            } else if (y >= 157 & y <= 161) {
                key = "d/3";
            } else if (y >= 162 & y <= 166) {
                key = "c/3";
            } else if (y >= 167 & y <= 171) {
                key = "b/2";
            } else if (y >= 172 & y <= 176) {
                key = "a/2";
            } else if (y >= 177 & y <= 181) {
                key = "g/2";
            } else if (y >= 182 & y <= 186) {
                key = "f/2";
            } else if (y >= 187 & y <= 191) {
                key = "e/2";
            } else if (y >= 192 & y <= 196) {
                key = "d/2";
            } else if (y > 197) {
                key = "c/2";
            }
            return key;
        }

        function getMeasure( x ) {
            // determine which of 4 measures you're in based on x position (horizontal)
        	var measure = null;

        	if (x > 10 & x < 210) {
        		measure = treble_stave_1;
        	} else if (x >= 210 & x < 410) {
        		measure = treble_stave_2;
        	} else if (x >= 410 & x < 610) {
        		measure = treble_stave_3;
        	} else if (x >= 610 & x < 810) {
        		measure = treble_stave_4;
        	}
        	return measure;
      	}




        // FIX ME
        // function getMeasure( noteToDraw, location, color ) {
        //     if (noteToDraw != null) {
        //     	var note = [new VF.StaveNote({clef: "treble", keys: [s1], duration: "w"})];
        //     	note[0].setStyle({ fillStyle: color});
        //     	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
        //     	voice.addTickables(note);
        //     	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
        //     	voice.draw(context, location);
        //     }
        // }




        function analyzeNotes() {
            // Build analysis code here.
        	var output = "";

        	// Make sure all notes have a value.
        	if (!s1
        		|| !s2
        		|| !s3
        		|| !s4
        		|| !a1
        		|| !a2
        		|| !a3
        		|| !a4
        		|| !t1
        		|| !t2
        		|| !t3
        		|| !t4
        		|| !b1
        		|| !b2
        		|| !b3
        		|| !b4
        		) {
        		output = "Incomplete score.";
        	}

        	// If so, analyze.
        	else {
        		// Grab note values
        		var s1_noteValue = s1.substr(0,1);
        		var s2_noteValue = s2.substr(0,1);
        		var s3_noteValue = s3.substr(0,1);
        		var s4_noteValue = s4.substr(0,1);
        		var a1_noteValue = a1.substr(0,1);
        		var a2_noteValue = a2.substr(0,1);
        		var a3_noteValue = a3.substr(0,1);
        		var a4_noteValue = a4.substr(0,1);
        		var t1_noteValue = t1.substr(0,1);
        		var t2_noteValue = t2.substr(0,1);
        		var t3_noteValue = t3.substr(0,1);
        		var t4_noteValue = t4.substr(0,1);
        		var b1_noteValue = b1.substr(0,1);
        		var b2_noteValue = b2.substr(0,1);
        		var b3_noteValue = b3.substr(0,1);
        		var b4_noteValue = b4.substr(0,1);

        		// Check for parallel octaves
        		// Soprano and alto
        		if ((s1_noteValue == a1_noteValue && s2_noteValue == a2_noteValue) && s1 != s2) {
        			output = output + "Parallel octaves between measures 1 and 2 (soprano and alto).\n";
        		}
        		if ((s2_noteValue == a2_noteValue && s3_noteValue == a3_noteValue) && s2 != s3) {
        			output = output + "Parallel octaves between measures 2 and 3 (soprano and alto).\n";
        		}  
        		if ((s3_noteValue == a3_noteValue && s4_noteValue == a4_noteValue) && s3 != s4) {
        			output = output + "Parallel octaves between measures 3 and 4 (soprano and alto).\n";
        		}

        		// Soprano and tenor
        		if ((s1_noteValue == t1_noteValue && s2_noteValue == t2_noteValue) && s1 != s2) {
        			output = output + "Parallel octaves between measures 1 and 2 (soprano and tenor).\n";
        		}
        		if ((s2_noteValue == t2_noteValue && s3_noteValue == t3_noteValue) && s2 != s3) {
        			output = output + "Parallel octaves between measures 2 and 3 (soprano and tenor).\n";
        		}  
        		if ((s3_noteValue == t3_noteValue && s4_noteValue == t4_noteValue) && s3 != s4) {
        			output = output + "Parallel octaves between measures 3 and 4 (soprano and tenor).\n";
        		}    

        		// Soprano and bass
        		if ((s1_noteValue == b1_noteValue && s2_noteValue == b2_noteValue) && s1 != s2) {
        			output = output + "Parallel octaves between measures 1 and 2 (soprano and bass).\n";
        		}
        		if ((s2_noteValue == b2_noteValue && s3_noteValue == b3_noteValue) && s2 != s3) {
        			output = output + "Parallel octaves between measures 2 and 3 (soprano and bass).\n";
        		}  
        		if ((s3_noteValue == b3_noteValue && s4_noteValue == b4_noteValue) && s3 != s4) {
        			output = output + "Parallel octaves between measures 3 and 4 (soprano and bass).\n";
        		}


        		// Alto and tenor
        		if ((a1_noteValue == t1_noteValue && a2_noteValue == t2_noteValue) && a1 != a2) {
        			output = output + "Parallel octaves between measures 1 and 2 (alto and tenor).\n";
        		}
        		if ((a2_noteValue == t2_noteValue && a3_noteValue == t3_noteValue) && a2 != a3) {
        			output = output + "Parallel octaves between measures 2 and 3 (alto and tenor).\n";
        		}  
        		if ((a3_noteValue == t3_noteValue && a4_noteValue == t4_noteValue) && a3 != a4) {
        			output = output + "Parallel octaves between measures 3 and 4 (alto and tenor).\n";
        		}

        		// Alto and bass
        		if ((a1_noteValue == b1_noteValue && a2_noteValue == b2_noteValue) && a1 != a2) {
        			output = output + "Parallel octaves between measures 1 and 2 (alto and bass).\n";
        		}
        		if ((a2_noteValue == b2_noteValue && a3_noteValue == b3_noteValue) && a2 != a3) {
        			output = output + "Parallel octaves between measures 2 and 3 (alto and bass).\n";
        		}  
        		if ((a3_noteValue == b3_noteValue && a4_noteValue == b4_noteValue) && a3 != a4) {
        			output = output + "Parallel octaves between measures 3 and 4 (alto and bass).\n";
        		} 

        		// Tenor and bass
        		if ((t1_noteValue == b1_noteValue && t2_noteValue == b2_noteValue) && t1 != t2) {
        			output = output + "Parallel octaves between measures 1 and 2 (tenor and bass).\n";
        		}
        		if ((t2_noteValue == b2_noteValue && t3_noteValue == b3_noteValue) && t2 != t3) {
        			output = output + "Parallel octaves between measures 2 and 3 (tenor and bass).\n";
        		}  
        		if ((t3_noteValue == b3_noteValue && t4_noteValue == b4_noteValue) && t3 != t4) {
        			output = output + "Parallel octaves between measures 3 and 4 (tenor and bass).\n";
        		}
        	}


        	// Create output if no issues found.
        	if (output = ""){
        		output = "No issues found."
        	}
        	return output;
      	}



        //  On Vexflow SVG click (content renderer)
        $("#boo svg").click(function(e){
            console.log(e);
            var originalEvent = e.originalEvent;
            var activeGroup = null;

            if (originalEvent && originalEvent.offsetX && originalEvent.offsetY) {
                console.log('x: ' + originalEvent.screenX + ' y: ' + originalEvent.screenY);
                console.log('x: ' + originalEvent.offsetX + ' y: ' + originalEvent.offsetY);
                console.log(treble_stave_1.getTopLineTopY()); // 79.5 in chrome
                console.log(treble_stave_1.getNoteStartX()); // 67.9 in Chrome
                var screenX = originalEvent.screenX;
                var screenY = originalEvent.screenY;
                var offsetX = originalEvent.offsetX;
                var offsetY = originalEvent.offsetY;
                var keyName = getKeyFromScreenY(offsetY);
                console.log(keyName);
                var keyArray = [keyName];
// 
                var note = new VF.StaveNote({clef: "treble", keys: keyArray, duration: "w" });
                notes = [note];
                voice = new VF.Voice({num_beats: 4, beat_value: 4});

                // Add color to note based on voice
                if (document.getElementById('soprano').checked == true) {
                	note.setStyle({ fillStyle: S_COLOR});
                	console.log('Soprano note color changed');
                } else if (document.getElementById('alto').checked == true) {
                	note.setStyle({ fillStyle: A_COLOR});
                	console.log('Alto note color changed');
               	} else if (document.getElementById('tenor').checked == true) {
                	note.setStyle({ fillStyle: T_COLOR});
                	console.log('Tenor note color changed');
                } else if (document.getElementById('bass').checked == true) {
                	note.setStyle({ fillStyle: B_COLOR});
                	console.log('Bass note color changed');
                }

                // Assign value to note variables
                if (document.getElementById('soprano').checked == true) {
                	if (getMeasure(offsetX) == treble_stave_1) {
                		s1 = keyName;
                		activeGroup = group_s1;
                		console.log('s1 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_2) {
                		s2 = keyName;
                		activeGroup = group_s2;
						console.log('s2 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_3) {
                		s3 = keyName;
                		activeGroup = group_s2;
                		console.log('s3 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_4) {
                		s4 = keyName;
                		activeGroup = group_s2;
                		console.log('s4 changed to ' + keyName);
                	}
                } else if (document.getElementById('alto').checked == true) {
                	if (getMeasure(offsetX) == treble_stave_1) {
                		a1 = keyName;
                		console.log('a1 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_2) {
                		a2 = keyName;
                		console.log('a2 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_3) {
                		a3 = keyName;
                		console.log('a3 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_4) {
                		a4 = keyName;
                		console.log('a4 changed to ' + keyName);
                	}
                } else if (document.getElementById('tenor').checked == true) {
                	if (getMeasure(offsetX) == treble_stave_1) {
                		t1 = keyName;
                		console.log('t1 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_2) {
                		t2 = keyName;
                		console.log('t2 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_3) {
                		t3 = keyName;
                		console.log('t3 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_4) {
                		t4 = keyName;
                		console.log('t4 changed to ' + keyName);
                	}
                } else if (document.getElementById('bass').checked == true) {
                	if (getMeasure(offsetX) == treble_stave_1) {
                		b1 = keyName;
                		console.log('b1 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_2) {
                		b2 = keyName;
                		console.log('b2 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_3) {
                		b3 = keyName;
                		console.log('b3 changed to ' + keyName);
                	} else if (getMeasure(offsetX) == treble_stave_4) {
                		b4 = keyName;
                		console.log('b4 changed to ' + keyName);
                	}
                }


				// note = new VF.StaveNote({clef: "treble", keys: s1, duration: "w" });

                voice.addTickables(notes);
                
                var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);



                // remove previous group:
                context.svg.removeChild(group);
                group = context.openGroup();
                voice.draw(context, getMeasure(offsetX));


       			// Statements to draw all notes with values:
                // Cannot get getMeasure to work - temporary solution:
	            //getMeasure(s1, treble_stave_1, S_COLOR);

	            if (s1 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [s1], duration: "w"})];
	            	note[0].setStyle({ fillStyle: S_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_1);
            	}

            	if (s2 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [s2], duration: "w"})];
	            	note[0].setStyle({ fillStyle: S_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_2);
            	}

            	if (s3 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [s3], duration: "w"})];
	            	note[0].setStyle({ fillStyle: S_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_3);
            	}

            	if (s4 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [s4], duration: "w"})];
	            	note[0].setStyle({ fillStyle: S_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_4);
            	}

            	if (a1 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [a1], duration: "w"})];
	            	note[0].setStyle({ fillStyle: A_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_1);
            	}

            	if (a2 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [a2], duration: "w"})];
	            	note[0].setStyle({ fillStyle: A_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_2);
            	}

            	if (a3 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [a3], duration: "w"})];
	            	note[0].setStyle({ fillStyle: A_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_3);
            	}

            	if (a4 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [a4], duration: "w"})];
	            	note[0].setStyle({ fillStyle: A_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_4);
            	}

            	if (t1 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [t1], duration: "w"})];
	            	note[0].setStyle({ fillStyle: T_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_1);
            	}

            	if (t2 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [t2], duration: "w"})];
	            	note[0].setStyle({ fillStyle: T_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_2);
            	}

            	if (t3 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [t3], duration: "w"})];
	            	note[0].setStyle({ fillStyle: T_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_3);
            	}

            	if (t4 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [t4], duration: "w"})];
	            	note[0].setStyle({ fillStyle: T_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_4);
            	}

            	if (b1 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [b1], duration: "w"})];
	            	note[0].setStyle({ fillStyle: B_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_1);
            	}

            	if (b2 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [b2], duration: "w"})];
	            	note[0].setStyle({ fillStyle: B_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_2);
            	}

            	if (b3 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [b3], duration: "w"})];
	            	note[0].setStyle({ fillStyle: B_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_3);
            	}

            	if (b4 != null) {
	            	var note = [new VF.StaveNote({clef: "treble", keys: [b4], duration: "w"})];
	            	note[0].setStyle({ fillStyle: B_COLOR});
	            	var voice = new VF.Voice({num_beats: 4, beat_value: 4});
	            	voice.addTickables(note);
	            	var formatter = new VF.Formatter().joinVoices([voice]).format([voice], WIDTH);
	            	voice.draw(context, treble_stave_4);
            	}




                context.closeGroup();
            }






        });






	</script>
	<button id="Analyze" onclick="document.getElementById('Output').innerHTML=analyzeNotes()">Analyze</button>
	<div id="Output"></div>
</body>
</html>